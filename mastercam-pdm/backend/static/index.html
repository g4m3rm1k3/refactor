<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mastercam PDM</title>
    <link rel="stylesheet" href="/static/css/tailwind.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      /* Custom button color overrides for better visibility */

      /* Secondary buttons - better light mode contrast */
      .btn-secondary {
        background-color: #d1d5db;
        color: #1f2937;
        border: 2px solid #9ca3af;
      }

      .btn-secondary:hover {
        background-color: #9ca3af;
        border-color: #6b7280;
      }

      .dark .btn-secondary {
        background-color: rgb(75 85 99);
        color: rgb(243 244 246);
        border-color: rgb(107 114 128);
      }

      .dark .btn-secondary:hover {
        background-color: rgb(107 114 128);
        border-color: rgb(75 85 99);
      }

      /* File action button color fixes */
      .file-btn-checkout {
        background-color: #16a34a;
        color: white;
        border: 2px solid #15803d;
      }

      .file-btn-checkout:hover {
        background-color: #15803d;
      }

      .file-btn-checkin {
        background-color: #2563eb;
        color: white;
        border: 2px solid #1d4ed8;
      }

      .file-btn-checkin:hover {
        background-color: #1d4ed8;
      }

      .file-btn-cancel {
        background-color: #ca8a04;
        color: white;
        border: 2px solid #a16207;
      }

      .file-btn-cancel:hover {
        background-color: #a16207;
      }

      .file-btn-download {
        background-color: #d1d5db;
        color: #1f2937;
        border: 2px solid #9ca3af;
      }

      .file-btn-download:hover {
        background-color: #9ca3af;
      }

      .dark .file-btn-download {
        background-color: rgb(75 85 99);
        color: rgb(243 244 246);
        border-color: rgb(107 114 128);
      }

      .dark .file-btn-download:hover {
        background-color: rgb(107 114 128);
      }

      .file-btn-history {
        background-color: #d1d5db;
        color: #1f2937;
        border: 2px solid #9ca3af;
      }

      .file-btn-history:hover {
        background-color: #9ca3af;
      }

      .dark .file-btn-history {
        background-color: rgb(75 85 99);
        color: rgb(243 244 246);
        border-color: rgb(107 114 128);
      }

      .dark .file-btn-history:hover {
        background-color: rgb(107 114 128);
      }

      .file-btn-delete {
        background-color: #dc2626;
        color: white;
        border: 2px solid #b91c1c;
      }

      .file-btn-delete:hover {
        background-color: #b91c1c;
      }

      .file-btn-override {
        background-color: #f97316;
        color: white;
        border: 2px solid #ea580c;
      }

      .file-btn-override:hover {
        background-color: #ea580c;
      }

      .file-btn-status {
        background-color: #3b82f6;
        color: white;
        border: 2px solid #2563eb;
      }

      .file-btn-status:hover {
        background-color: #2563eb;
      }

      .file-btn-link {
        background-color: #9333ea;
        color: white;
        border: 2px solid #7e22ce;
      }

      .file-btn-link:hover {
        background-color: #7e22ce;
      }

      /* Admin subtab styles */
      .admin-subtab {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
        background: none;
        border: none;
        cursor: pointer;
        color: inherit;
      }

      .admin-subtab:hover {
        border-bottom-color: #f59e0b;
      }

      .admin-subtab.active {
        border-bottom-color: #f59e0b;
        color: #f59e0b;
      }

      .admin-subtab-content {
        display: none;
      }

      .admin-subtab-content:not(.hidden) {
        display: block;
      }
    </style>
  </head>

  <body class="app-bg app-text font-sans antialiased">
    <div class="flex flex-col h-screen">
      <header class="flex-shrink-0 header-bg shadow-md z-30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between h-16">
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-3">
                <i class="fa-solid fa-database text-2xl text-accent"></i>
                <h1 class="text-xl font-bold">Mastercam PDM</h1>
              </div>
              <div
                id="status-indicators"
                class="hidden md:flex items-center space-x-4 border-l border-border-color pl-4"
              >
                <div class="flex items-center space-x-2">
                  <div
                    id="connectionStatus"
                    class="w-3 h-3 rounded-full bg-gray-400"
                  ></div>
                  <span id="connectionText" class="text-sm font-medium"
                    >Connecting...</span
                  >
                </div>
                <div class="flex items-center space-x-2">
                  <i class="fa-solid fa-user"></i>
                  <span id="currentUser" class="text-sm font-medium">...</span>
                </div>
              </div>
            </div>

            <div class="flex items-center space-x-2">
              <div class="relative hidden sm:block">
                <i
                  class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 opacity-70"
                ></i>
                <input
                  type="text"
                  id="searchInput"
                  placeholder="Search..."
                  class="w-48 lg:w-64 pl-9 pr-10 py-2 text-sm rounded-md"
                />
                <button
                  id="clearSearchBtn"
                  class="absolute right-3 top-1/2 -translate-y-1/2 opacity-70 hidden"
                >
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </div>
              <button id="newFileBtn" class="btn btn-primary">
                <i class="fa-solid fa-plus"></i
                ><span class="hidden lg:inline">New File</span>
              </button>
              <button id="dashboardBtn" class="btn btn-secondary">
                <i class="fa-solid fa-chart-line"></i
                ><span class="hidden lg:inline">Dashboard</span>
              </button>
              <div
                id="adminActionsContainer"
                class="flex items-center space-x-2"
              ></div>
              <div class="h-6 w-px bg-border-color mx-2"></div>
              <button
                id="collapseAllBtn"
                class="btn btn-secondary !px-3"
                title="Collapse All"
              >
                <i class="fa-solid fa-compress"></i>
              </button>
              <div class="h-6 w-px bg-border-color mx-2"></div>
              <button
                id="darkModeBtn"
                class="btn btn-secondary !px-3"
                title="Toggle Dark Mode"
              >
                <i class="fa-solid fa-moon"></i>
              </button>
              <button
                id="tooltipBtn"
                class="btn btn-secondary !px-3"
                title="Toggle Tooltips"
              >
                <i class="fa-solid fa-question"></i>
              </button>
              <button
                id="configBtn"
                class="btn btn-secondary !px-3"
                title="Settings"
              >
                <i class="fa-solid fa-gear"></i>
              </button>
              <button
                id="logoutBtn"
                class="btn btn-secondary !px-3"
                title="Logout"
              >
                <i class="fa-solid fa-right-from-bracket"></i>
              </button>
            </div>
          </div>
        </div>
      </header>

      <main
        class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8 overflow-y-auto"
      >
        <div id="fileList" class="space-y-4">
          <div class="flex justify-center items-center py-24 text-gray-500">
            <div
              class="animate-spin rounded-full h-12 w-12 border-4 border-gray-300 border-t-amber-500"
            ></div>
          </div>
        </div>
      </main>
    </div>

    <div
      id="notification-container"
      class="fixed bottom-4 right-4 z-[1000] w-full max-w-sm space-y-3"
    ></div>

    <template id="file-card-template">
      <div
        class="py-6 px-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-300 dark:border-gray-600 hover:shadow-lg transition-shadow"
        data-file-id=""
      >
        <div
          class="flex flex-col md:flex-row md:items-start md:justify-between space-y-4 md:space-y-0"
        >
          <div class="flex-grow">
            <div class="flex items-center space-x-3 mb-2 flex-wrap">
              <h4
                class="text-lg font-semibold text-gray-900 dark:text-white"
                data-field="filename"
              ></h4>
              <span
                class="text-xs font-semibold px-2.5 py-1 rounded-full"
                data-field="revision"
              ></span>
              <span
                class="text-xs font-semibold px-2.5 py-1 rounded-full"
                data-field="status"
              ></span>
            </div>
            <p
              class="italic text-gray-700 dark:text-gray-300 text-sm mb-3"
              data-field="description"
            ></p>
            <div
              class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-400"
            >
              <div
                class="flex items-center space-x-2"
                data-field="size-container"
              >
                <i class="fa-solid fa-hard-drive"></i
                ><span data-field="size"></span>
              </div>
              <div class="flex items-center space-x-2">
                <i class="fa-solid fa-clock"></i
                ><span data-field="modified_at"></span>
              </div>
            </div>
            <div
              class="flex items-center space-x-2 text-sm mt-2"
              data-field="lock-info"
            ></div>
          </div>
          <div
            class="flex items-center space-x-2 flex-wrap"
            data-field="action-buttons"
          ></div>
        </div>
      </div>
    </template>

    <template id="template-checkin-modal">
      <div class="panel-bg rounded-xl shadow-lg p-6 w-full max-w-lg">
        <form id="checkinForm">
          <h3 id="checkinModalTitle" class="text-xl font-semibold mb-4">
            Check In File
          </h3>
          <div class="mb-4">
            <label for="commitMessage" class="block text-sm font-medium mb-1"
              >Describe your changes:</label
            >
            <textarea
              id="commitMessage"
              name="commitMessage"
              rows="3"
              required
              class="input-field"
            ></textarea>
          </div>
          <div class="mb-4">
            <label
              for="checkinFileUpload"
              class="block text-sm font-medium mb-1"
              >Upload the updated file:</label
            >
            <input
              id="checkinFileUpload"
              name="file"
              type="file"
              required
              class="w-full text-sm"
            />
          </div>
          <div class="flex justify-end space-x-3">
            <button type="button" class="btn btn-secondary" data-action="close">
              Cancel
            </button>
            <button type="submit" class="btn btn-info">Submit Check-in</button>
          </div>
        </form>
      </div>
    </template>

    <template id="template-new-upload-modal">
      <div class="panel-bg rounded-xl shadow-lg p-6 w-full max-w-lg">
        <form id="newUploadForm" class="space-y-4" novalidate>
          <h3 class="text-xl font-semibold mb-2">Add New File or Link</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <input
                type="radio"
                id="uploadTypeFile"
                name="uploadType"
                value="file"
                class="hidden peer"
                checked
              />
              <label
                for="uploadTypeFile"
                class="block p-3 text-center rounded-lg border-2 border-gray-300 dark:border-gray-600 cursor-pointer peer-checked:border-accent peer-checked:text-accent hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"
              >
                <i class="fa-solid fa-file-arrow-up text-xl mb-1"></i>
                <div class="font-semibold">Upload File</div>
              </label>
            </div>
            <div>
              <input
                type="radio"
                id="uploadTypeLink"
                name="uploadType"
                value="link"
                class="hidden peer"
              />
              <label
                for="uploadTypeLink"
                class="block p-3 text-center rounded-lg border-2 border-gray-300 dark:border-gray-600 cursor-pointer peer-checked:border-accent peer-checked:text-accent hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"
              >
                <i class="fa-solid fa-link text-xl mb-1"></i>
                <div class="font-semibold">Create Link</div>
              </label>
            </div>
          </div>
          <div id="fileUploadContainer">
            <label for="newFileUpload" class="block text-sm font-medium"
              >Mastercam File <span class="text-red-500">*</span></label
            >
            <input
              type="file"
              id="newFileUpload"
              name="file"
              accept=".mcam,.vnc,.emcam"
              class="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400"
            />
          </div>
          <div id="linkCreateContainer" class="hidden space-y-4">
            <div>
              <label for="newLinkFilename" class="block text-sm font-medium"
                >New Filename for Link <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="newLinkFilename"
                name="new_link_filename"
                placeholder="e.g., 1234567_ABC123"
                class="input-field"
              />
            </div>
            <div>
              <label for="linkToMaster" class="block text-sm font-medium"
                >Link to Master File <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="linkToMaster"
                name="link_to_master"
                list="masterFileList"
                placeholder="Start typing to see available files..."
                class="input-field"
              />
            </div>
          </div>
          <div>
            <label for="newFileDescription" class="block text-sm font-medium"
              >Description <span class="text-red-500">*</span></label
            >
            <input
              type="text"
              id="newFileDescription"
              name="description"
              placeholder="Part name per title block"
              required
              class="input-field"
            />
          </div>
          <div>
            <label for="newFileRev" class="block text-sm font-medium"
              >Initial Revision <span class="text-red-500">*</span></label
            >
            <input
              type="text"
              id="newFileRev"
              name="rev"
              placeholder="1.0"
              required
              pattern="^\d+\.\d+$"
              class="input-field"
            />
          </div>
          <div class="flex justify-end space-x-3 pt-4">
            <button type="button" class="btn btn-secondary" data-action="close">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <span id="submitBtnText">Create</span>
              <i id="submitSpinner" class="fa-solid fa-spinner fa-spin ml-2 hidden"></i>
            </button>
          </div>
        </form>
      </div>
    </template>

    <datalist id="masterFileList"></datalist>

    <template id="template-dashboard-modal">
      <div
        class="panel-bg rounded-xl shadow-lg w-full max-w-4xl flex flex-col max-h-[90vh]"
      >
        <div
          class="flex-shrink-0 flex justify-between items-center p-6 pb-4 border-b"
        >
          <h3 class="text-xl font-semibold">
            <i class="fa-solid fa-chart-line mr-2"></i>Activity Dashboard
          </h3>
          <button class="text-gray-500" data-action="close">
            <i class="fa-solid fa-xmark text-2xl"></i>
          </button>
        </div>
        <div
          id="dashboardContent"
          class="flex-grow min-h-0 p-6 flex flex-col md:flex-row md:space-x-6"
        ></div>
      </div>
    </template>

    <template id="template-config-panel">
      <div
        class="fixed inset-y-0 right-0 w-full max-w-md transform translate-x-full transition-transform duration-300 panel-bg shadow-lg p-6 z-50 overflow-y-auto"
      >
        <div
          class="flex justify-between items-center pb-4 mb-4 border-b border-gray-200 dark:border-gray-700"
        >
          <h3 class="text-2xl font-semibold text-gray-900 dark:text-accent">
            Settings
          </h3>
          <button
            class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white"
            data-action="close"
          >
            <i class="fa-solid fa-xmark text-2xl"></i>
          </button>
        </div>

        <div
          class="flex space-x-1 mb-6 border-b border-gray-200 dark:border-gray-700"
        >
          <button id="configTab" class="config-tab active">
            <i class="fa-solid fa-gear"></i> GitLab
          </button>
          <button id="adminTab" class="config-tab hidden">
            <i class="fa-solid fa-shield-halved"></i> Admin
          </button>
          <button id="healthTab" class="config-tab">
            <i class="fa-solid fa-heart-pulse"></i> Health
          </button>
          <button id="usersTab" class="config-tab hidden">
            <i class="fa-solid fa-users"></i> Users
          </button>
        </div>

        <div id="configContent" class="config-tab-content">
          <form id="configForm" class="space-y-4">
            <div>
              <label for="gitlabUrl" class="block text-sm font-medium"
                >GitLab URL</label
              >
              <input type="url" id="gitlabUrl" required class="input-field" />
            </div>
            <div>
              <label for="projectId" class="block text-sm font-medium"
                >Project ID</label
              >
              <input type="text" id="projectId" required class="input-field" />
            </div>
            <div>
              <label for="username" class="block text-sm font-medium"
                >Username</label
              >
              <input
                type="text"
                id="username"
                autocomplete="username"
                required
                class="input-field"
              />
            </div>
            <div>
              <label for="token" class="block text-sm font-medium"
                >Access Token</label
              >
              <input
                type="password"
                id="token"
                autocomplete="current-password"
                class="input-field"
              />
            </div>
            <div
              class="mt-6 pt-4 border-t border-gray-300 dark:border-gray-600"
            >
              <label
                for="allowInsecureSsl"
                class="flex items-center space-x-3 cursor-pointer"
              >
                <input
                  type="checkbox"
                  id="allowInsecureSsl"
                  name="allowInsecureSsl"
                  class="h-5 w-5 rounded"
                />
                <div class="flex flex-col">
                  <span class="font-semibold">Allow Insecure SSL</span>
                  <span class="text-sm text-red-600 dark:text-red-400 font-bold"
                    >(Not Recommended)</span
                  >
                </div>
              </label>
            </div>
            <button
              type="submit"
              class="btn btn-primary w-full justify-center !py-3"
            >
              <i class="fa-solid fa-floppy-disk"></i
              ><span>Save Configuration</span>
            </button>
          </form>
          <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
            <h4 class="text-lg font-semibold mb-2">Current Status</h4>
            <p class="text-sm">
              <strong>Status:</strong> <span id="configStatusText">...</span>
            </p>
            <p class="text-sm mt-1">
              <strong>Repository Path:</strong>
              <span id="configRepoText">...</span>
            </p>
          </div>
        </div>

        <div id="adminContent" class="config-tab-content hidden">
          <!-- Admin Configuration Navigation -->
          <div class="flex space-x-1 mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">
            <button class="admin-subtab active" data-tab="patterns">
              <i class="fa-solid fa-file-signature"></i> Patterns
            </button>
            <button class="admin-subtab" data-tab="repositories">
              <i class="fa-solid fa-database"></i> Repos
            </button>
            <button class="admin-subtab" data-tab="access">
              <i class="fa-solid fa-user-lock"></i> Access
            </button>
            <button class="admin-subtab" data-tab="maintenance">
              <i class="fa-solid fa-tools"></i> Tools
            </button>
          </div>

          <!-- Filename Patterns Tab -->
          <div id="adminPatterns" class="admin-subtab-content">
            <div class="space-y-4">
              <div class="flex justify-between items-center">
                <h4 class="text-lg font-semibold">
                  <i class="fa-solid fa-file-signature mr-2"></i>Filename Patterns
                </h4>
                <button id="addPatternBtn" class="btn btn-primary text-sm">
                  <i class="fa-solid fa-plus"></i> Add Pattern
                </button>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Define regex patterns for filename validation. Each pattern can be assigned to repositories.
              </p>
              <div id="patternsList" class="space-y-3">
                <div class="text-center py-8 text-gray-500">
                  <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                  <p>Loading patterns...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Repositories Tab -->
          <div id="adminRepositories" class="admin-subtab-content hidden">
            <div class="space-y-4">
              <div class="flex justify-between items-center">
                <h4 class="text-lg font-semibold">
                  <i class="fa-solid fa-database mr-2"></i>Repository Configuration
                </h4>
                <button id="addRepoBtn" class="btn btn-primary text-sm">
                  <i class="fa-solid fa-plus"></i> Add Repository
                </button>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Configure multiple repositories with different file types and naming patterns.
              </p>
              <div id="repositoriesList" class="space-y-3">
                <div class="text-center py-8 text-gray-500">
                  <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                  <p>Loading repositories...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- User Access Tab -->
          <div id="adminAccess" class="admin-subtab-content hidden">
            <div class="space-y-4">
              <div class="flex justify-between items-center">
                <h4 class="text-lg font-semibold">
                  <i class="fa-solid fa-user-lock mr-2"></i>User Repository Access
                </h4>
                <button id="addUserAccessBtn" class="btn btn-primary text-sm">
                  <i class="fa-solid fa-plus"></i> Add User
                </button>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Control which users can access which repositories. No entry = access to all.
              </p>
              <div id="userAccessList" class="space-y-3">
                <div class="text-center py-8 text-gray-500">
                  <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                  <p>Loading user access...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Maintenance Tab -->
          <div id="adminMaintenance" class="admin-subtab-content hidden">
            <div class="space-y-6">
              <div>
                <h4 class="text-lg font-semibold mb-4">
                  <i class="fa-solid fa-tools mr-2"></i>Maintenance Tools
                </h4>
                <div class="space-y-3">
                  <button
                    id="createBackupBtn"
                    class="btn btn-secondary w-full justify-center"
                  >
                    <i class="fa-solid fa-floppy-disk mr-2"></i>Create Manual Backup
                  </button>
                  <button
                    id="cleanupLfsBtn"
                    class="btn btn-secondary w-full justify-center"
                  >
                    <i class="fa-solid fa-broom mr-2"></i>Cleanup Old Files
                  </button>
                  <button
                    id="exportRepoBtn"
                    class="btn btn-secondary w-full justify-center"
                  >
                    <i class="fa-solid fa-file-zipper mr-2"></i>Export Repository as Zip
                  </button>
                  <button
                    id="reloadConfigBtn"
                    class="btn btn-secondary w-full justify-center"
                  >
                    <i class="fa-solid fa-rotate mr-2"></i>Reload Config from GitLab
                  </button>
                </div>
              </div>
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <h4 class="text-lg font-semibold mb-2">
                  <i class="fa-solid fa-info-circle mr-2"></i>Configuration Info
                </h4>
                <div class="text-sm space-y-1" id="adminConfigInfo">
                  <p><strong>Config Version:</strong> <span id="configVersion">...</span></p>
                  <p><strong>Last Updated By:</strong> <span id="configUpdatedBy">...</span></p>
                  <p><strong>Last Updated:</strong> <span id="configUpdatedAt">...</span></p>
                  <p><strong>Polling Interval:</strong> <span id="configPolling">...</span>s</p>
                </div>
              </div>
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <h4 class="text-lg font-semibold mb-4 text-red-600">
                  <i class="fa-solid fa-triangle-exclamation mr-2"></i>Danger Zone
                </h4>
                <button
                  id="resetRepoBtn"
                  class="btn w-full justify-center bg-red-600 hover:bg-red-700 text-white"
                >
                  <i class="fa-solid fa-triangle-exclamation mr-2"></i>Reset Repository to GitLab
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="healthContent" class="config-tab-content hidden">
          <p>Health status loading...</p>
        </div>

        <div id="usersContent" class="config-tab-content hidden">
          <p>User management loading...</p>
        </div>
      </div>
    </template>

    <!-- Admin Config Modals -->
    <template id="template-pattern-modal">
      <div class="panel-bg rounded-xl shadow-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <form id="patternForm">
          <h3 id="patternModalTitle" class="text-xl font-semibold mb-4">
            <i class="fa-solid fa-file-signature mr-2"></i>Add Filename Pattern
          </h3>
          <div class="space-y-4">
            <div>
              <label for="patternName" class="block text-sm font-medium mb-1">
                Pattern Name <span class="text-red-500">*</span>
              </label>
              <input type="text" id="patternName" required class="input-field" placeholder="e.g., Extended Pattern 2025" />
            </div>
            <div>
              <label for="patternDescription" class="block text-sm font-medium mb-1">
                Description <span class="text-red-500">*</span>
              </label>
              <input type="text" id="patternDescription" required class="input-field" placeholder="e.g., 7 digits + 2 letters + unlimited numbers" />
            </div>
            <div>
              <label for="linkPattern" class="block text-sm font-medium mb-1">
                Link Pattern (Regex) <span class="text-red-500">*</span>
              </label>
              <input type="text" id="linkPattern" required class="input-field font-mono text-sm" placeholder="e.g., ^\d{7}_[A-Z]{2}\d+$" />
              <p class="text-xs text-gray-500 mt-1">Regex for link files (without extension)</p>
            </div>
            <div>
              <label for="filePattern" class="block text-sm font-medium mb-1">
                File Pattern (Regex) <span class="text-red-500">*</span>
              </label>
              <input type="text" id="filePattern" required class="input-field font-mono text-sm" placeholder="e.g., ^\d{7}_[A-Z]{2}\d+$" />
              <p class="text-xs text-gray-500 mt-1">Regex for regular files (without extension)</p>
            </div>
            <div>
              <label for="maxStemLength" class="block text-sm font-medium mb-1">
                Max Filename Length <span class="text-red-500">*</span>
              </label>
              <input type="number" id="maxStemLength" required class="input-field" value="20" min="1" max="100" />
              <p class="text-xs text-gray-500 mt-1">Maximum characters before file extension</p>
            </div>
            <div>
              <label for="exampleValid" class="block text-sm font-medium mb-1">
                Valid Examples (comma-separated)
              </label>
              <input type="text" id="exampleValid" class="input-field" placeholder="e.g., 1234567_AB123, 1234567_XY999" />
            </div>
            <div>
              <label for="exampleInvalid" class="block text-sm font-medium mb-1">
                Invalid Examples (comma-separated)
              </label>
              <input type="text" id="exampleInvalid" class="input-field" placeholder="e.g., 123456, 1234567_ABC123" />
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button type="button" class="btn btn-secondary" data-action="close">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Pattern</button>
          </div>
        </form>
      </div>
    </template>

    <template id="template-repository-modal">
      <div class="panel-bg rounded-xl shadow-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <form id="repositoryForm">
          <h3 id="repositoryModalTitle" class="text-xl font-semibold mb-4">
            <i class="fa-solid fa-database mr-2"></i>Add Repository
          </h3>
          <div class="space-y-4">
            <div>
              <label for="repoId" class="block text-sm font-medium mb-1">
                Repository ID <span class="text-red-500">*</span>
              </label>
              <input type="text" id="repoId" required class="input-field" placeholder="e.g., main, legacy, projects2025" />
              <p class="text-xs text-gray-500 mt-1">Unique identifier (lowercase, no spaces)</p>
            </div>
            <div>
              <label for="repoName" class="block text-sm font-medium mb-1">
                Display Name <span class="text-red-500">*</span>
              </label>
              <input type="text" id="repoName" required class="input-field" placeholder="e.g., Main Repository" />
            </div>
            <div>
              <label for="repoGitlabUrl" class="block text-sm font-medium mb-1">
                GitLab URL <span class="text-red-500">*</span>
              </label>
              <input type="url" id="repoGitlabUrl" required class="input-field" placeholder="https://gitlab.com/group/project" />
            </div>
            <div>
              <label for="repoProjectId" class="block text-sm font-medium mb-1">
                Project ID <span class="text-red-500">*</span>
              </label>
              <input type="text" id="repoProjectId" required class="input-field" placeholder="e.g., 74609002" />
            </div>
            <div>
              <label for="repoBranch" class="block text-sm font-medium mb-1">
                Branch <span class="text-red-500">*</span>
              </label>
              <input type="text" id="repoBranch" required class="input-field" value="main" />
            </div>
            <div>
              <label for="repoFileTypes" class="block text-sm font-medium mb-1">
                Allowed File Types <span class="text-red-500">*</span>
              </label>
              <div class="flex flex-wrap gap-2 mb-2" id="selectedFileTypes"></div>
              <div class="flex flex-wrap gap-2">
                <label class="inline-flex items-center">
                  <input type="checkbox" class="file-type-checkbox" value=".mcam" checked />
                  <span class="ml-2">.mcam</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" class="file-type-checkbox" value=".vnc" checked />
                  <span class="ml-2">.vnc</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" class="file-type-checkbox" value=".emcam" checked />
                  <span class="ml-2">.emcam</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" class="file-type-checkbox" value=".link" checked />
                  <span class="ml-2">.link</span>
                </label>
              </div>
            </div>
            <div>
              <label for="repoPatternId" class="block text-sm font-medium mb-1">
                Filename Pattern <span class="text-red-500">*</span>
              </label>
              <select id="repoPatternId" required class="input-field">
                <option value="">Select a pattern...</option>
              </select>
            </div>
            <div>
              <label for="repoDescription" class="block text-sm font-medium mb-1">
                Description
              </label>
              <textarea id="repoDescription" rows="2" class="input-field" placeholder="Optional repository description"></textarea>
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button type="button" class="btn btn-secondary" data-action="close">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Repository</button>
          </div>
        </form>
      </div>
    </template>

    <template id="template-user-access-modal">
      <div class="panel-bg rounded-xl shadow-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
        <form id="userAccessForm">
          <h3 id="userAccessModalTitle" class="text-xl font-semibold mb-4">
            <i class="fa-solid fa-user-lock mr-2"></i>Add User Access
          </h3>
          <div class="space-y-4">
            <div>
              <label for="accessUsername" class="block text-sm font-medium mb-1">
                Username <span class="text-red-500">*</span>
              </label>
              <input type="text" id="accessUsername" required class="input-field" placeholder="e.g., john_doe" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">
                Accessible Repositories <span class="text-red-500">*</span>
              </label>
              <div class="space-y-2 max-h-48 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded p-3" id="repositoryCheckboxes">
                <p class="text-sm text-gray-500">Loading repositories...</p>
              </div>
              <p class="text-xs text-gray-500 mt-1">Select at least one repository</p>
            </div>
            <div>
              <label for="defaultRepoId" class="block text-sm font-medium mb-1">
                Default Repository
              </label>
              <select id="defaultRepoId" class="input-field">
                <option value="">None (use first in list)</option>
              </select>
              <p class="text-xs text-gray-500 mt-1">Repository to open on login</p>
            </div>
          </div>
          <div class="flex justify-end space-x-3 mt-6">
            <button type="button" class="btn btn-secondary" data-action="close">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Access</button>
          </div>
        </form>
      </div>
    </template>

    <template id="template-login-modal">
      <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md"
      >
        <div class="text-center mb-8">
          <i class="fa-solid fa-database text-5xl text-amber-500 mb-4"></i>
          <h1 class="text-3xl font-bold">Mastercam PDM</h1>
        </div>

        <form id="loginForm" class="space-y-4 hidden">
          <p class="text-gray-600 dark:text-gray-400 text-center">
            Authentication Required
          </p>
          <div>
            <label class="block text-sm font-medium mb-1">Username</label>
            <input
              type="text"
              id="loginUsername"
              required
              readonly
              class="input-field w-full bg-gray-100 dark:bg-gray-700"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Password</label>
            <input
              type="password"
              id="loginPassword"
              required
              class="input-field w-full"
              placeholder="Enter your password"
            />
          </div>
          <button
            type="submit"
            class="btn btn-primary w-full justify-center py-3"
          >
            Login
          </button>
        </form>

        <form id="setupPasswordForm" class="space-y-4 hidden">
          <h3 class="text-xl font-semibold text-center">First-Time Setup</h3>
          <p class="text-sm text-center text-gray-500">
            To secure your account, please prove your identity.
          </p>
          <div>
            <label class="block text-sm font-medium mb-1"
              >GitLab Username</label
            >
            <input
              type="text"
              id="setupUsername"
              required
              readonly
              class="input-field w-full bg-gray-100 dark:bg-gray-700"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1"
              >GitLab Personal Access Token</label
            >
            <input
              type="password"
              id="setupGitlabToken"
              required
              class="input-field w-full"
              placeholder="Enter your GitLab PAT"
            />
            <p class="text-xs text-gray-500 mt-1">
              This is used once to verify your identity and is not stored.
            </p>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1"
              >New App Password</label
            >
            <input
              type="password"
              id="setupPassword"
              required
              minlength="8"
              class="input-field w-full"
              placeholder="At least 8 characters"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1"
              >Confirm App Password</label
            >
            <input
              type="password"
              id="confirmPassword"
              required
              class="input-field w-full"
            />
          </div>
          <button
            type="submit"
            class="btn btn-primary w-full justify-center py-3"
          >
            Create Account & Login
          </button>
          <div class="text-center mt-4">
            <button
              type="button"
              id="switchToLoginBtn"
              class="text-sm text-accent hover:underline"
            >
              Already have a password? Login here
            </button>
          </div>
        </form>
      </div>
    </template>

    <script src="/static/js/main.js" type="module"></script>
  </body>
</html>
